{% extends "layout-startpage.html" %}
{% load static %}

{% block content %}

<!-- /.row -->

<div class="row" style="height: 100%;">
    <!--videooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo-->
     <div class="fullscreen-bg">
         <video loop muted autoplay poster="img/videoframe.jpg" class="fullscreen-bg__video">
             <!--<video loop muted autoplay poster="" class="fullscreen-bg__video">-->
             <source src="/static/ttaa_examples/img/main_video.webm" type="video/webm">
             <source src="/static/ttaa_examples/img/main_video.mp4" type="video/mp4">
         </video>
     </div>
    <!--videooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo-->
    <div class="col-lg-12" style="height: 100%; margin-top: 60px;">
        <nav class="Quick-navigation dotstyle dotstyle-fillup">
            <ul>
            <li><a href="#A" class="Quick-navigation-item ">A</a></li><br><br>
            <li><a href="#B" class="Quick-navigation-item ">B</a></li><br><br>
            <li><a href="#C" class="Quick-navigation-item ">C</a></li><br><br>
            <li><a href="#D" class="Quick-navigation-item ">D</a></li><br><br>
            <li><a href="#E" class="gotoE Quick-navigation-item ">E</a></li><br><br>
            <li><a href="#F" class="gotoF Quick-navigation-item ">F</a></li><br><br>
            <li><a href="#G" class="gotoG Quick-navigation-item ">G</a></li><br><br>
            <li><a href="#H" class="gotoH Quick-navigation-item ">H</a></li><br><br>
            <!-- <li><a href="#I" class="gotoI Quick-navigation-item ">I</a></li><br><br> -->
            <div class="Scroll-progress-indicator"></div>
            </ul>
        </nav>

<!--aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-->
    <div id="A" class="container js-scroll-step" style="height:100%">
        <div class="row title-f">
            <h1 class="first-title">Effective Tax Rate Analytics</h1>
        </div>
        <div class="row title-s">
            <label class="second-title">Which company are you currently working for?</label>
        </div>

        <form class="input-content">
            <div class="row drop-box">
                <div class="col-sm-3"></div>
                <div class="col-sm-4" style="transform: scale(1.1, 1.1); margin-top: 10px">
                <select id="companyDropdown" style="color:black"></select><br>
                <select id="industryDropdown"  style="color:black"></select>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <!-- <button type="button" id="" class="btn btn-default next gotoA">Back</button> -->
                </div>
                <div class="col-sm-10">
                </div>
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoB">Next</button><!--change button's class later-->
                </div>
            </div>
        </form>
    </div>
<!--aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-->


<!--bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb-->
    <div id="B" class="container js-scroll-step" style="height:100%">
        <div class="row title-f">
            <h1 class="first-title">Effective Tax Rate Analytics</h1>
        </div>
        <div class="row title-s">
            <label class="second-title">Where do you see your company's ETR?</label>
        </div>
        <form class="input-content">
            <div class="row r-slider">
                <div class="col-sm-5"></div>
                <div class="col-sm-4" style="transform: scale(1.3,1.3); margin-top: 30px">
                <div id="yourETRSlider"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoA">Back</button>
                </div>
                <div class="col-sm-10"></div>
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoC">Next</button>
                    </div>
            </div>
        </form>
    </div>
<!--bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb-->


<!--cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc-->
    <div id="C" class="container js-scroll-step" style="height:100%">
        <div class="row title-f">
            <h1 class="first-title">Effective Tax Rate Analytics</h1>
        </div>
        <div class="row title-s">
            <label class="second-title">Where do you want to be? (realistically)</label>
        </div>
        <form class="input-content">
            <div class="row r-slider">
                <div class="col-sm-5"></div>
                <div class="col-sm-4" style="transform: scale(1.3,1.3); margin-top: 30px">
                <div id="yourGoalETRSlider"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoB">Back</button>
                </div>
                <div class="col-sm-10"></div>
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoD">Next</button><!--change button's class later-->
                </div>
            </div>
        </form>
    </div>
<!--cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc-->

<!--dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd-->
    <div id="D" class="container js-scroll-step" style="height:100%">
        <div class="row title-f">
            <h1 class="first-title">Effective Tax Rate Analytics</h1>
        </div>
        <div class="row title-s">
            <label class="second-title">Where do you see the industry?</label>
        </div>
        <form class="input-content">
            <div class="row r-slider">
            <div class="col-sm-5"></div>
            <div class="col-sm-4" style="transform: scale(1.3,1.3); margin-top:30px">
                <div id="yourPeersETRSlider"></div>
            </div>
            </div>
            <div class="row">
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoC">Back</button>
                </div>
                <div class="col-sm-10"></div>
                <div class="col-sm-2 next-btn" style="right: 0px;">
                    <button type="button" id="" class="btn btn-default next gotoE">Next</button><!--change button's class later-->
                </div>
            </div>
        </form>
    </div>
<!--dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd-->

<!--eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-->
    <div id="E" class="container js-scroll-step" style="height:100%">
        <div class="row title-s" style="height: 7%">
            <label class="second-title" style="padding: 0px; font-size: 40px; padding-left: 30px">ETR Overview</label>
        </div>
        <div class="row" style="height: 63%">
            <div class="col-lg-12">
                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                         <div class="panel-body" style="font-size: 16px; font-weight: bold">
On the bottom left you can see the ETR development of your company.<br><br>
On the bottom right you can see the average ETR development of the industry.<br><br>
Please click on the graphics to see more details. <br>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourETR"></canvas>
                         </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your Goal ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourGoalETR" ></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your peers</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourPeersETR" ></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="col-lg-6">
                    <div class="panel panel-default gotoF">
                        <!-- <div class="panel-heading">Your development</div>  -->
                        <div class="panel-body" style="cursor: pointer; height:300px">
                            <canvas style="height:300px" id="barChartYourDevelopment"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="panel panel-default gotoG">
                        <!-- <div class="panel-heading">Development of Peers</div> -->
                        <div class="panel-body" style="cursor: pointer; height:300px">
                            <canvas style="height:300px" id="barChartYourPeersDevelopment"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row"style="height: 30%">
                <div class="col-sm-2 next-btn" style="left: -120px; bottom: 100px">
                    <button type="button" id="" class="btn btn-default next gotoD">Back</button>
                </div>
                <div class="col-sm-10"></div>
                <div class="col-sm-2 next-btn" style="right: -100px; bottom: 100px">
                    <button type="button" id="" class="btn btn-default next gotoF">Next</button><!--change button's class later-->
                </div>
            </div>
        </div>
    </div>
<!--eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-->

<!--ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff-->
    <div id="F" class="container js-scroll-step" style="height: 100%">
        <div class="row title-s" style="height: 7%">
            <label class="second-title" style="padding: 0px; font-size: 40px; padding-left: 30px">Company Analysis</label>
        </div>
        <div class="row" style="height: 53%">
            <div class="col-lg-12">
                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                        <div class="panel-body" style="font-size: 16px; font-weight: bold">
On the bottom left you can see the ETR development of your company. <br><br>
On the bottom right you can see the reconciliation items, which influences the ETR, grouped by year. <br><br><br>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourETR2"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your Goal ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourGoalETR2" ></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your peers</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourPeersETR2" ></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your development</div> -->
                        <div class="panel-body" style="height:300px">
                            <canvas  style="height:300px" id="barChartYourDevelopment2"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading" style="font-weight: bold; font-size:16px; color: black; height:40px">Reconciliation items</div>
                        <div class="panel-body" style="height: 260px; overflow: auto;">
                            <table id="reconciliationItemsTable" class="table table-striped table-bordered table-hover" style="width:98%" >
                                <thead>
                                    <tr>
                                    <td>Year</td>
                                    <td>Item</td>
                                    <td>Value</td>
                                    <td>Ratio</td>
                                    </tr>
                                </thead>
                                <tbody >
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="height: 30%">
                <div class="col-sm-2 next-btn" style="left: -120px; bottom: 120px">
                    <button type="button" id="" class="btn btn-default next gotoE">Back</button>
                </div>
                <div class="col-sm-10"></div>
                <div class="col-sm-2 next-btn" style="right: -100px; bottom: 120px">
                    <button type="button" id="" class="btn btn-default next gotoG">Next</button><!--change button's class later-->
                </div>
            </div>
        </div>
    </div>
<!--ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff-->

<!--gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg-->
    <div id="G" class="container js-scroll-step" style="height:100%">
        <div class="row title-s" style="height: 7%">
            <label class="second-title" style="padding: 0px; font-size: 40px;  padding-left: 30px">Peers Analysis</label>
        </div>
        <div class="row" style="height: 50%">
            <div class="col-lg-12">
                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                        <div class="panel-body" style="font-size: 16px; font-weight:bold">
On the bottom right you can see the peers development of selected industry. <br><br>
On the left of the graphics you can select Industry and Companies which you want to compare as well as which years. <br><br>

                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your current ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourETR3"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your Goal ETR</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourGoalETR3" ></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading">Your peers</div> -->
                        <div class="panel-body">
                            <canvas id="doughnutChartYourPeersETR3" ></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="col-lg-4">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="panel panel-default">
                                <div class="panel-heading" style="padding:5px 5px 5px 5px; height: 40px;">
                                    <input type="text" id="filterIndustry" class="filterInput" onkeyup="indusFilter()" placeholder="Industry" title="Type in a name">
                                </div>
                                <div class="panel-body" id="industryCheckboxList" style="padding-top: 0px; height: 200px; overflow: auto;"></div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="panel panel-default">
                                <div class="panel-heading" style="padding:5px 5px 5px 5px; height:40px">
                                    <input type="text" id="filterCompany" class="filterInput" onkeyup="companyFilter()" placeholder="Company" title="Type in a name">
                                </div>
                                <div class="panel-body" id="companyCheckboxList" style="padding-top: 0px; height: 200px; overflow: auto;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">Year</div>
                                <div class="panel-body" id="yearCheckboxList" style="padding-top: 0px; height: 60px; overflow: auto;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="panel panel-default">
                        <!-- <div class="panel-heading" style="font-weight: bold; font-size:16px; color: black">Development of Peers</div> -->
                        <div class="panel-body" id="panelforbubble" style="padding-top: 0px; height:360px">
                            <canvas id="bubbleChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="height: 30%">
            <div class="col-sm-2 next-btn"  style="left: -120px; bottom: 150px">
                <button type="button" id="" class="btn btn-default next gotoF">Back</button>
            </div>
            <div class="col-sm-8"></div>
            <div class="col-sm-2 next-btn" style="right: -300px; bottom: 150px">
                <button type="button" id="" class="btn btn-default next gotoH">Next</button>
            </div>
        </div>
    </div>
<!--gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg-->

<!--hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh-->
    {% block predictETR %}
    {% include "etr_benchmarking/predictETR.html" %}
    {% endblock %}

<!--hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh-->
<!--iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii-->
<!--<div id="I" class="container js-scroll-step"> -->
    <!--</div> -->
<!--iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii-->
</div>
</div>


{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static 'ttaa_examples/vendor/chartjs/Chart.min.js' %}"></script>
<script src="{% static 'ttaa_examples/js/etrpredict.js'%}" type="text/javascript" ></script>

<script>
function indusFilter(obj) {
    // Declare variables
    var input, filter, ul, li, i;
    input = document.getElementById('filterIndustry');
    filter = input.value.toUpperCase();
    li = document.getElementById('industryCheckboxList').getElementsByTagName('li');
    for (i = 0; i < li.length; i++) {
        // console.log(li[i].getElementsByTagName("p")[0],li[i].getElementsByTagName("p")[0].innerHTML.toUpperCase().indexOf(filter) );
        if(li[i].getElementsByTagName("p")[0].innerHTML.toUpperCase().indexOf(filter) == -1){
            li[i].style.display = "none";
        }
        else{
            li[i].style.display = "";
        }
    }
}
function companyFilter(obj) {
    // Declare variables
    var input, filter, ul, li, i;
    input = document.getElementById('filterCompany');
    filter = input.value.toUpperCase();
    li = document.getElementById('companyCheckboxList').getElementsByTagName('li');
    for (i = 0; i < li.length; i++) {
        // console.log(li[i].getElementsByTagName("p")[0],li[i].getElementsByTagName("p")[0].innerHTML.toUpperCase().indexOf(filter) );
        if(li[i].getElementsByTagName("p")[0].innerHTML.toUpperCase().indexOf(filter) == -1){
            li[i].style.display = "none";
        }
        else{
            li[i].style.display = "";
        }
    }
}
</script>

<script>
$("#yourETRSlider").roundSlider({
    radius: 80,
    width: 8,
    handleSize: "+16",
    handleShape: "dot",
    sliderType: "min-range",
    value: 50,
    tooltipFormat: "changeTooltipYourETR"

});
function changeTooltipYourETR(e) {
    var val = e.value, speed;
    return val + "%";
}
$("#yourGoalETRSlider").roundSlider({
    radius: 80,
    width: 8,
    handleSize: "+16",
    handleShape: "dot",
    sliderType: "min-range",
    value: 49,
    tooltipFormat: "changeTooltipYourGoalETR"
});
function changeTooltipYourGoalETR(e) {
    var val = e.value, speed;
    return val + "%";
}
$("#yourPeersETRSlider").roundSlider({
    radius: 80,
    width: 8,
    handleSize: "+16",
    handleShape: "dot",
    sliderType: "min-range",
    value: 51,
    tooltipFormat: "changeTooltipYourPeersETR"
});
function changeTooltipYourPeersETR(e) {
    var val = e.value, speed;
    return val + "%";
}
</script>


<script type="text/javascript" src="{% static 'ttaa_examples/vendor/chartjs/Chart.min.js' %}"></script>

<script>
$(document).ready(function(){

    Chart.defaults.global.defaultFontColor = 'black';
    Chart.defaults.global.defaultFontSize = 16;
    Chart.defaults.global.defaultFontStyle = 'bold';

    var colors = getEyColors();
	var years = [];
	var industries = [];
	var companies = [];

	getCompanyDropdownValues();
	getIndustryDropdownValues();
    getYearValues();

    $('.gotoE').on("click", function(){
		updateDashboard1();
	});
	$('.gotoF').on("click", function(){
		updateDashboard2();
	});
    $('.gotoG').on("click", function(){
		updateDashboard3();
	});
    $('.gotoH').on("click", function(){
		getCompanyForDropdown();
	});


    $('#industryCheckboxList').on('change', function(){
        var selectedCompany = $('#companyDropdown option:selected').val();
        createPeerComparisonBubbleChart(selectedCompany);
    });
    $('#companyCheckboxList').on('change', function(){
        var selectedCompany = $('#companyDropdown option:selected').val();
        createPeerComparisonBubbleChart(selectedCompany);
    });
    $('#yearCheckboxList').on('change', function(){
        var selectedCompany = $('#companyDropdown option:selected').val();
        createPeerComparisonBubbleChart(selectedCompany);
    });

    // text in doughnutchart pluginnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn
    Chart.pluginService.register({
        beforeDraw: function (chart) {
            if (chart.config.options.elements.center) {
                //Get ctx from string
                var ctx = chart.chart.ctx;
                    
                //Get options from the center object in options
                var centerConfig = chart.config.options.elements.center;
                var fontStyle = centerConfig.fontStyle || 'Arial';
                        var txt = centerConfig.text;
                var color = centerConfig.color || '#111';
                var sidePadding = centerConfig.sidePadding || 20;
                var sidePaddingCalculated = (sidePadding/100) * (chart.innerRadius * 2)
                //Start with a base font of 30px
                ctx.font = "30px " + fontStyle;
                    
                //Get the width of the string and also the width of the element minus 10 to give it 5px side padding
                var stringWidth = ctx.measureText(txt).width;
                var elementWidth = (chart.innerRadius * 2) - sidePaddingCalculated;

                // Find out how much the font can grow in width.
                var widthRatio = elementWidth / stringWidth;
                var newFontSize = Math.floor(30 * widthRatio);
                var elementHeight = (chart.innerRadius * 2);

                // Pick a new font size so it will not be larger than the height of label.
                var fontSizeToUse = Math.min(newFontSize, elementHeight);

                //Set font settings to draw it correctly.
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                var centerX = ((chart.chartArea.left + chart.chartArea.right) / 2);
                var centerY = ((chart.chartArea.top + chart.chartArea.bottom) / 2);
                ctx.font = fontSizeToUse+"px " + fontStyle;
                ctx.fillStyle = color;
                    
                //Draw text in center
                ctx.fillText(txt, centerX, centerY);
            }
        }
    });
    // text in doughnutchart pluginnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn

	function updateDashboard1(){

        var yourETR = $("#yourETRSlider").data("roundSlider").option("value");
        var yourGoalETR = $("#yourGoalETRSlider").data("roundSlider").option("value");
        var yourPeersETR = $("#yourPeersETRSlider").data("roundSlider").option("value");
        var selectedCompany = $('#companyDropdown option:selected').val();
        var selectedIndustry = $('#industryDropdown option:selected').val();

        //alert(yourETR + " " + yourGoalETR + " " + yourPeersETR +" " + selectedCompany + " " +selectedIndustry);

        updateETRDevelopment(selectedCompany);

        var ctx = document.getElementById("doughnutChartYourETR").getContext("2d");
        var myChart1 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourETR, 100-yourETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey,
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    " Estimated ETR",
                    // "Not Your ETR"
                ]
            },
            options: {
                animation:{
                    duration: 0
                },
                elements: {
				    center: {
					    text: yourETR+"%",
                        color: '#000000', // Default is #000000
                        // fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
        var ctx = document.getElementById("doughnutChartYourGoalETR").getContext("2d");
        var myChart2 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourGoalETR, 100-yourGoalETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1',
                    // labelColor:colors.red
                }],
                labels: [
                    " Goal ETR",
                    // "Not Your Goal ETR"
                ]
            },
            options: {
                animation:{
                    duration: 0
                },
                elements: {
				    center: {
					    text: yourGoalETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
                
            }
        });
        var ctx = document.getElementById("doughnutChartYourPeersETR").getContext("2d");
        var myChart3 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourPeersETR, 100-yourPeersETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Estimated peers",
                    // "Not Your Peers ETR"
                ]
            },
            options: {
                animation:{
                    duration: 0
                },
                elements: {
				    center: {
					    text: yourPeersETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });

	}


    function updateDashboard2(){

        var yourETR = $("#yourETRSlider").data("roundSlider").option("value");
        var yourGoalETR = $("#yourGoalETRSlider").data("roundSlider").option("value");
        var yourPeersETR = $("#yourPeersETRSlider").data("roundSlider").option("value");
        var selectedCompany = $('#companyDropdown option:selected').val();
        var selectedIndustry = $('#industryDropdown option:selected').val();

        //alert(yourETR + " " + yourGoalETR + " " + yourPeersETR +" " + selectedCompany + " " +selectedIndustry);

        updateETRDevelopment(selectedCompany);
        getReconciliationItems(selectedCompany);

        var ctx = document.getElementById("doughnutChartYourETR2").getContext("2d");
        var myChart1 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourETR, 100-yourETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Estimated ETR",
                    // "Not Your ETR"
                ]
            },
            options: {
                elements: {
				    center: {
					    text: yourETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                 layout: {
                    padding: {
                         left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
        var ctx = document.getElementById("doughnutChartYourGoalETR2").getContext("2d");
        var myChart2 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourGoalETR, 100-yourGoalETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Goal ETR",
                    // "Not Your Goal ETR"
                ]
            },
            options: {
                elements: {
				    center: {
					    text: yourGoalETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                 layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
        var ctx = document.getElementById("doughnutChartYourPeersETR2").getContext("2d");
        var myChart3 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourPeersETR, 100-yourPeersETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Estimated peers",
                    // "Not Your Peers ETR"
                ]
            },
            options: {
                elements: {
				    center: {
					    text: yourPeersETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                 layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
	}

    function updateDashboard3(){

        var yourETR = $("#yourETRSlider").data("roundSlider").option("value");
        var yourGoalETR = $("#yourGoalETRSlider").data("roundSlider").option("value");
        var yourPeersETR = $("#yourPeersETRSlider").data("roundSlider").option("value");
        var selectedCompany = $('#companyDropdown option:selected').val();
        var selectedIndustry = $('#industryDropdown option:selected').val();

        // alert(yourETR + " " + yourGoalETR + " " + yourPeersETR +" " + selectedCompany + " " +selectedIndustry);
        $('.industryCheckbox').each(function(){
            if ($(this).parent().text() == selectedIndustry){
                $(this).prop('checked', true);
            } else {
                $(this).prop('checked', false);
            }
        });
        $('.companyCheckbox').each(function(){
            if ($(this).parent().text() == selectedCompany){
                $(this).prop('checked', true);
            } else {
                $(this).prop('checked', false);
            }
        });
        $('.yearCheckbox').each(function(){
            $(this).prop('checked', true);
        });


        createPeerComparisonBubbleChart(selectedCompany);

        var ctx = document.getElementById("doughnutChartYourETR3").getContext("2d");
        var myChart1 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourETR, 100-yourETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    " Estimated ETR",
                    // "Not Your ETR"
                ]
            },
            options: {
                elements: {
				    center: {
					    text: yourETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
        var ctx = document.getElementById("doughnutChartYourGoalETR3").getContext("2d");
        var myChart2 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourGoalETR, 100-yourGoalETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Goal ETR",
                    // "Not Your Goal ETR"
                ]
            },
            options: {

                elements: {
				    center: {
					    text: yourGoalETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                 layout: {
                    padding: {
                         left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
        var ctx = document.getElementById("doughnutChartYourPeersETR3").getContext("2d");
        var myChart3 = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [yourPeersETR, 100-yourPeersETR],
                    backgroundColor: [
                        colors.yellow,
                        // colors.blueSpecial,
                        // colors.purpleSpecial,
                        // colors.greenSpecial,
                        // colors.lilacSpecial,
                        colors.grey
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Estimated peers",
                    // "Not Your Peers ETR"
                ]
            },
            options: {
                elements: {
				    center: {
					    text: yourPeersETR+"%",
                        color: '#000000', // Default is #000000
                        fontStyle: 'Arial', // Default is Arial
                        sidePadding: 20 // Defualt is 20 (as a percentage)
				    }
			    },
                 layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 5,
                        bottom: 10
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                //title: {
                    //display: true,
                    //text: 'Chart.js Doughnut Chart'
                //},
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
	}

    function createPeerComparisonBubbleChart(companyName){
        // alert(companyName);
        var companies = [];
        var industries = [];
        var years = [];
        $('.industryCheckbox').each(function(){
            if ($(this).prop('checked') == true){
                industries.push($(this).parent().text());
            }
        });
        $('.companyCheckbox').each(function(){
            if ($(this).prop('checked') == true){
                companies.push($(this).parent().text());
            }
        });
        $('.yearCheckbox').each(function(){
            if ($(this).prop('checked') == true){
                years.push($(this).parent().text());
            }
        });
        //console.log(companies, industries, years);


        $.ajax({
			type: "POST",
			url: '../getBubbleChartData/',
			data: { companyName: companyName, companies: companies, industries: industries, years: years },
			dataType: 'json',
			success: function (response){
			    var bubbleChartData = response.bubbleChartData;
			    var industries = [];
			    var companies = [];
                var chartObjects = [];
                var chartYear = [];
                var lineObjects = [];
                var chartCompany = [];
                console.log(bubbleChartData);
			    for (var i = 0; i < bubbleChartData.length; i++){
			        // var year = bubbleChartData[i][0];
                    var company = bubbleChartData[i][1];
                    var industry = bubbleChartData[i][2];
                    // var value = bubbleChartData[i][3];
			        if (industries.indexOf(industry) == -1){
			            industries.push(industry);
			        }
			        if (companies.indexOf(company) == -1){
			            companies.push(company);
			        }
				}
				companies.sort();
				industries.sort();

				for (var i = 0; i < bubbleChartData.length; i++){
                    var year = bubbleChartData[i][0];
                    var company = bubbleChartData[i][1];
                    var industry = bubbleChartData[i][2];
                    var value = parseFloat(bubbleChartData[i][3])*100;
                    value=Number(value.toFixed(1));
                    // chartYear.push(year);
                    lineObjects.push(value);//temporary for the values to show in the chart
                    shortcompany=company.split(" ");
                    chartCompany.push(shortcompany[0]);
				}
				//chartDataString = chartDataString.substring(0, chartDataString.length - 1);
                //chartDataString += " ]}]}";
                //var json = JSON.parse(chartDataString);
//console.log(chartDataString);//alert(industries);alert(companies);

// scan every chartCompany with line Objects, if they have the same name, then combine the value in lineObejct
                var bubblecompany =[];
                var bubbleave = [];
                var times = [];
                // initial the array for saving the sum of the etr for each company
                for(var n = 0; n < companies.length; n++){
                    bubbleave.push(Number(0));
                    times.push(Number(0)); //to count how many year's information does the company have
                }
                // combine the same company of different years
                for(var m = 0; m < chartCompany.length; m++)
                {
                    var t = chartCompany.indexOf(chartCompany[m]);
			        // if (chartCompany[m].indexOf(chartCompany) != -1){
                    if(t != -1){
                        times[t]++;
                        // alert(times[t]);
                    }
			        bubblecompany[t] = chartCompany[m];
                    var singleValue = Number(lineObjects[m]);
                    bubbleave[t] = Number(bubbleave[t])+Number(singleValue.toFixed(2));
                    // alert(bubbleave);
			        // }                
                }
                // calculate the average number
                for(var p = 0; p < bubblecompany.length; p++){
                    t = bubbleave[p]/times[p];
                    bubbleave[p] = t.toFixed(2);
                    // bubbleave[p] = Numver(bubbleave[p].toFixed(2));
                }
                // alert(bubbleave);
                // alert(bubblecompany);

                //remove the cache of the bubblechart
                $('#bubbleChart').remove(); 
                $('#panelforbubble').append('<canvas id="bubbleChart"><canvas>');

                var ctx = document.getElementById("bubbleChart").getContext("2d");
                // console.log(chartObjects);
                var myBubbleChart = new Chart(ctx,{
                    type: 'line',
                    data: {
                        labels: bubblecompany,
                        // labels: [1],
                        datasets: [{
                            data: bubbleave,
                            showLine: false,
                            backgroundColor: 'grey',
                            borderColor: 'grey',
                            fill: false,
                            pointRadius: 10,
                            pointHoverRadius: 15,
                        }]
                    },
                    options: {
                        responsive: true,
                        title:{
                            display: true,
                            text: 'Development of Peers',
                            padding: 20,
                            fontSize: 18
                        },
                        maintainAspectRatio: false,
                        legend: {
                            display: false,
                        //     labels: {
                        //         // fontColor: 'rgb(255, 99, 132)'
                        //         text: 'aaaa'
                        //     },
                        //     callbacks: {
                        // // Use the footer callback to display the sum of the items showing in the tooltip
                        //         text: function(label, data) {
                        //             // return companies[tooltipItem.xLabel]+"("+chartYear[tooltipItem.index]+")"+":"+chartObjects[tooltipItem.index].r;
                        //             return "aaaaa";
                        //         },
                        //     },   
                        },
                        scales: {
                            xAxes: [{
                                ticks: {
                                    // stepSize: 5,
                                    fontSize: 13
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Company'
                                }
                            }],
                            yAxes: [{
                                ticks: {
                                    fontSize: 13
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'ETR(%)'
                                }
                            }]
                        }
                    }
                });
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});

        //         var ctx = document.getElementById("bubbleChart").getContext("2d");
        //         // console.log(chartObjects);
        //         var myBubbleChart = new Chart(ctx,{
        //             type: 'bubble',
        //             data: {
        //                 datasets: [{
        //                     data: chartObjects
        //                 }]
        //             },
        //             options: {
        //                 responsive: true,
        //                 title:{
        //                     display: true,
        //                     text: 'Development of Peers',
        //                     padding: 25,
        //                     fontSize: 18
        //                 },
        //                 // maintainAspectRatio: false,
        //                 // title:{
        //                 //     display:false
        //                 // },
        //                 tooltips:{
        //                     mode:'nearest',
        //                     // titleFontColor: 'red' ,
        //                     // backgroundColor: 'blue', 
        //                     callbacks: {
        //                 // Use the footer callback to display the sum of the items showing in the tooltip
        //                         label: function(tooltipItem, data) {
        //                             return companies[tooltipItem.xLabel]+"("+chartYear[tooltipItem.index]+")"+":"+chartObjects[tooltipItem.index].r;
        //                             // return "x:"+tooltipItem.xLabel+"y:"+tooltipItem.yLabel+"2:"+chartObjects[tooltipItem.index].r;
        //                         },
        //                     },                        
        //                 },
        //                 responsive: true,
        //                 legend: {
        //                     display: false,
        //                     labels: {
        //                         // fontColor: 'rgb(255, 99, 132)'
        //                     }
        //                 },
        //                 scales: {
        //                     xAxes: [{
        //                         ticks: {
        //                             stepSize: 1,
        //                             callback: function(value, index, values) {
        //                                 var s = "";
        //                                 if (typeof companies[value] != 'undefined'){
        //                                 // s = companies[value].substring(0,5)
        //                                     s=companies[value].split(" ");
        //                                 // s = companies[value]
        //                                 }
        //                                 // console.log(s[0]);
        //                                 return s[0];
        //                             }
        //                         },
        //                         scaleLabel: {
        //                             display: true,
        //                             labelString: 'Company'
        //                         }
        //                     }],
        //                     yAxes: [{
        //                         ticks: {
        //                             stepSize: 1,
        //                             callback: function(value, index, values) {
        //                                 var s = "";
        //                                 if (typeof industries[value] != 'undefined'){
        //                                     // s = industries[value].substring(0,10)
        //                                     s=industries[value].split(",");
        //                                     w=s[0].split(" ");
        //                                     // s = industries[value]
        //                                 }
        //                             console.log(w[0]);
        //                             return w[0];
        //                             }
        //                         },
        //                         scaleLabel: {
        //                             display: true,
        //                             labelString: 'Industry'
        //                         }
        //                     }]
        //                 }
        //             }
        //         });
		// 	},
		// 	error: function(XMLHttpRequest, textStatus, errorThrown) {
		// 		console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
		// 	}
		// });
    }

    function getReconciliationItems(companyName){
        $.ajax({
			type: "POST",
			url: '../getReconciliationItems/',
			data: { companyName: companyName },
			dataType: 'json',
			success: function (response){
			    var reconciliationItems = response.reconciliationItems;
                var recon2014sum = response.recon2014sum;
                var recon2015sum = response.recon2015sum;
                var recon2016sum = response.recon2016sum;

                var t1, t2, t3;
                var c;
                // alert(recon2015sum);
                // alert(recon2016sum);
			    //alert(reconciliationItems);
			     $('#reconciliationItemsTable tbody').empty();
			    for (var i = 0; i < reconciliationItems.length; i++){
                    if(reconciliationItems[i][0]=="2014"){
                        if(parseFloat(reconciliationItems[i][2])<0){c="yellow";} else{c="grey;"}
                        t1=Math.abs(reconciliationItems[i][2]/recon2014sum)*100;
                        $('#reconciliationItemsTable tbody').append('<tr><td>'+reconciliationItems[i][0]+'</td><td>'+reconciliationItems[i][1]+'</td><td>'+reconciliationItems[i][2]+'</td><td><div style="background-color:white; width:100%"><div style="background-color:'+c+'; width:'+t1+'%">'+t1.toFixed(2)+'%</div></div></td></tr>');
                        // console.log(Math.abs(reconciliationItems[i][2]/recon2014sum));
                    }
                    if(reconciliationItems[i][0]=="2015"){
                        if(parseFloat(reconciliationItems[i][2])<0){c="yellow";} else{c="grey;"}
                        t2=Math.abs(reconciliationItems[i][2]/recon2015sum)*100;
                        $('#reconciliationItemsTable tbody').append('<tr><td>'+reconciliationItems[i][0]+'</td><td>'+reconciliationItems[i][1]+'</td><td>'+reconciliationItems[i][2]+'</td><td><div style="background-color:white; width:100%"><div style="background-color:'+c+'; width:'+t2+'%">'+t2.toFixed(2)+'%</div></div></td></tr>');
                    }
                    if(reconciliationItems[i][0]=="2016"){
                        if(parseFloat(reconciliationItems[i][2])<0){c="yellow";} else{c="grey;"}
                        t3=Math.abs(reconciliationItems[i][2]/recon2016sum)*100;
                        $('#reconciliationItemsTable tbody').append('<tr><td>'+reconciliationItems[i][0]+'</td><td>'+reconciliationItems[i][1]+'</td><td>'+reconciliationItems[i][2]+'</td><td><div style="background-color:white; width:100%"><div style="background-color:'+c+'; width:'+t3+'%">'+t3.toFixed(2)+'%</div></div></td></tr>');
                    }
                }
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});
    }

    function updateETRDevelopment(companyName){
        $.ajax({
			type: "POST",
			url: '../getETRforEachYearforCompanyName/',
			data: { companyName: companyName },
			dataType: 'json',
			success: function (response){
			    var years = [];
			    var ETRs = [];
			    var ETRHistory = response.ETRHistory;
			    for (var i = 0; i < ETRHistory.length; i++){
					years.push(ETRHistory[i][0]);
					ETRs.push(ETRHistory[i][1]);
				}

				var ctx = document.getElementById("barChartYourDevelopment").getContext("2d");
                var myChart4 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [{
                            label: "Your ETR",
                            backgroundColor: colors.yellow,
                            borderColor: colors.yellow,
                            data: ETRs,
                            fill: false
                        }],
                    },
                    options: {
                        maintainAspectRatio: false,
                        responsive: true,
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Years'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Value(%)'
                                },
                                // ticks: {
                                //     beginAtZero: true
                                // }
                            }]
                        }, 
                    }
                });

                var ctx = document.getElementById("barChartYourDevelopment2").getContext("2d");
                var myChart4 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [{
                            label: "Your ETR",
                            backgroundColor: colors.yellow,
                            borderColor: colors.yellow,
                            data: ETRs,
                            fill: false
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        responsive: true,
                        //title:{
                            //display:true,
                            //text:'Chart.js Line Chart'
                        //},
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Years'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Value(%)'
                                },
                                // ticks: {
                                //     beginAtZero: true
                                // }                                
                            }]
                        }
                    }
                });
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});
		$.ajax({
			type: "POST",
			url: '../getETRforEachYearforPeers/',
			data: { companyName: companyName },
			dataType: 'json',
			success: function (response){
			    var years = [];
			    var ETRs = [];
			    var ETRHistory = response.ETRHistory;
			    for (var i = 0; i < ETRHistory.length; i++){
					years.push(ETRHistory[i][0]);
					ETRs.push(ETRHistory[i][1]);
				}

				var ctx = document.getElementById("barChartYourPeersDevelopment").getContext("2d");
                var myChart5 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [{
                            label: "Peers ETR",
                            backgroundColor: colors.grey,
                            borderColor: colors.grey,
                            data: ETRs,
                            fill: false
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        responsive: true,
                        //title:{
                            //display:true,
                            //text:'Chart.js Line Chart'
                        //},
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Years'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Value(%)'
                                }
                            }]
                        }
                    }
                });
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});

    };


	function getIndustryDropdownValues() {
		$.ajax({
			type: "POST",
			url: '../getIndustryDropdownValues/',
			data: "",
			dataType: 'json',
			contentType: false,
			processData: false,
			success: function (response){
			    industries = [];
				var industryList = response.industryList;
                $('#industryCheckboxList').empty();
				for (var i = 0; i < industryList.length; i++){
					$('#industryDropdown').append('<option>'+industryList[i]+'</option>');
					industries.push(industryList[i]);
					$('#industryCheckboxList').append('<div class="checkbox"><li style="list-style:none"><label><input class="industryCheckbox" type="checkbox" value=""><p>'+industryList[i]+'</p></label></li></div>');

                }  
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});
	}
	function getCompanyDropdownValues() {
		$.ajax({
			type: "POST",
			url: '../getCompanyDropdownValues/',
			data: "",
			dataType: 'json',
			contentType: false,
			processData: false,
			success: function (response){
				companies = [];
				var companyList = response.companyList;
				$('#companyCheckboxList').empty();
				for (var i = 0; i < companyList.length; i++){
					$('#companyDropdown').append('<option>'+companyList[i]+'</option>');
					companies.push(companyList[i]);
					$('#companyCheckboxList').append('<div class="checkbox"><li style="list-style:none"><label><input class="companyCheckbox" type="checkbox" value=""><p>'+companyList[i]+'</p></label></li></div>');
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});
	}
	function getYearValues() {
		$.ajax({
			type: "POST",
			url: '../getYearValues/',
			data: "",
			dataType: 'json',
			contentType: false,
			processData: false,
			success: function (response){
			    years = [];
				var yearList = response.yearList;
				$('#yearCheckboxList').empty();
				for (var i = 0; i < yearList.length; i++){
					//$('#industryDropdown').append('<option>'+yearList[i]+'</option>');
					years.push(yearList[i]);
					$('#yearCheckboxList').append('<div class="checkbox"><label><input class="yearCheckbox" type="checkbox" value="">'+yearList[i]+'</label></div>');
					// $('#yearCheckboxList').append('<label><input class="checkbox yearCheckbox" type="checkbox" value="">'+yearList[i]+'</label></div>');

				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log("Status: " + textStatus + " " + "Error: " + errorThrown);
			}
		});
	}



});

$.ajaxSetup({
     beforeSend: function(xhr, settings) {
         function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie != '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                     if (cookie.substring(0, name.length + 1) == (name + '=')) {
                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                         break;
                     }
                 }
             }
             return cookieValue;
         }
         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
             // Only send the token to relative URLs i.e. locally.
             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
         }
     }
});

</script>
{% endblock %}
